<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Fan's Blog</title><meta name="author" content="Fan"><meta name="copyright" content="Fan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Fan&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Fan&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:author" content="Fan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="http://example.com/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Fan\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-11-16 11:06:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Fan's Blog"><span class="site-name">Fan's Blog</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/11/16/map-reduce/" title="論文閱讀： MapReduce Simplified Data Processing on Larger Clusters">論文閱讀： MapReduce Simplified Data Processing on Larger Clusters</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-11-15T16:09:23.000Z" title="Created 2023-11-16 00:09:23">2023-11-16</time></span></div><div class="content">介紹MapReduce 是 Google 所提出的一個 Programming Model，目標是要實現簡單的介面讓工程師就能夠將大量資料分散到不同機器運算。MapReduce 其實就是利用 Divide and Conquer 的概念將大資料切分成小資料後再分別處理後在合再一起，透過這樣的方式可以讓這些被切分的小資料能夠被分散到不同機器上執行。
MapReduce 的 Programming ModelMapReduce 的 Programming Model 由 Map 和 Reduce 這兩個行為所組成，將傳入的 Key Value 資料經過這兩個行為後得出結果
Map (Divide)由使用者自定義的行為，會將 Key Value 的資料根據相同的 Key 或其他邏輯將這些資料組成有相同類型資料的 intermediate 資料。Map 這邊在定義的時候必須要考慮資料計算的幂等性，相同的資料不管計算幾次出來的 intermediate 資料應該都要是一樣，原因為 MapReduce 是一個分散式的系統架構，如果機器失效導致當下的這個 Map 失敗的話就必須讓其他機器來執行，當沒 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/11/10/chean-architecture-chapter-two/" title="Clean Architecture Chapter Two">Clean Architecture Chapter Two</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-11-10T13:42:00.000Z" title="Created 2023-11-10 21:42:00">2023-11-10</time></span></div><div class="content">行為與架構的價值軟體利用其行為提供價值，而軟體架構的價值在於設計的良好可以用最低的成本提供行為或改變行為。當下開發能夠馬上滿足行為而不管架構提供價值，這對老闆或者 PM 的回饋是相當直接的，但某種意義上這只是未來的時間拿補上現在的時間，未來要改變行為時，所花的時間成本絕對是相當高的。
為架構發聲PM 跟老闆不懂良好架構的有利之處這是合理的，畢竟他們不是軟體專業，所以說服他們就是你展現專業的時候！
</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/11/09/chear-architechure-chapter-one/" title="Clean Architecture Chapter One">Clean Architecture Chapter One</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-11-09T13:47:15.000Z" title="Created 2023-11-09 21:47:15">2023-11-09</time></span></div><div class="content">好的軟體設計目標是什麼軟體架構的目標是 最小化 建議與維護時所需的人力。
不好的軟體架構會發生什麼事？從書中的案例來看，可以發現不好的程式碼會讓工程師的產出與成本為反比，就算越多的工程師跟越多的預算也無法達成期望的產出。因為設計不好的程式碼會讓工程師在開發的過程中寸步難行之外也可以有改 A 壞 B 的狀況出現。
結論不好的程式碼從短期開發的確很快，但是後續迭代上去的成本絕對是很高的。
想要走得快，唯一的方法就是要走得好
本書會介紹什麼是好的架構與設計，讓開發人員可以走得長久。
</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/10/21/cache-intro/" title="什麼是 Cache">什麼是 Cache</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-10-21T08:15:38.000Z" title="Created 2023-10-21 16:15:38">2023-10-21</time></span></div><div class="content">Cache 概述Cache 就是將之後要再使用的資料存在記憶體中，這樣就不用去很慢的非揮發性存儲空間拿取資料，這不止是在後端架構中很常見，OS 或 Database 中的 Buffer 其實都是 Cache 的一種，在這邊會專注在後端系統架構中的 Cache。後端的 Cache 常見的工具有，Application 的內存、Redis、Memcache。
什麼時候要用 Cache
靜態網站資料，例如：不會變動的使用者資訊或者圖片等等
需求從 DB 或者非揮發性存儲空間拿取的資料，且這些資料不太容易有變動

Cache 的使用策略Cache 最常遇到的就是要處理在 Cache 中找不到資料跟資料更新時 Cache 要怎麼處理一致性的這些問題，常見的讀寫策略有以下幾種，這些策略各有優缺點端看系統在設計時的需求考量。
Read 策略Read 相對單純，只需要處理 Cache Miss，但通常都不會有太大問題
Cache AsideCache 更新的處理主要是由 Application 來做，當出現 Cache Miss 的時候，Application 會跟 Database 拿新的資料並且更 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/10/05/intro-time-series-db/" title="Time Series Database 簡介"><img class="post-bg" src="/2023/10/05/intro-time-series-db/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Time Series Database 簡介"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/10/05/intro-time-series-db/" title="Time Series Database 簡介">Time Series Database 簡介</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-10-04T16:32:17.000Z" title="Created 2023-10-05 00:32:17">2023-10-05</time></span></div><div class="content">什麼是 Time Series Database顧名思義就是專門存儲有時間序列相關資料的 Database。什麼是時間序列相關資料 ? 想像今天有個 Sensor 不斷的紀錄溫濕度的資料回傳到 Server 上，這個資料的內容會類似下圖這些資料就是所謂的時間序列相關的資料，這個資料一定是向後新增。



Unix時間戳記
溫度 (攝氏度)
濕度 (%)



1641019200
25.5
60


1641105600
26.0
58


1641192000
24.8
62


1641278400
27.2
55


1641364800
28.5
50


Time Series data 為什麼需要特殊的 Database如果將 Time Series Data 的資料放到常見的關聯式資料庫，會遇到怎麼樣的問題？

資料量過多空間消耗過大
Query 時，因為資料量過多導致速度慢
Aggregation 效能差

而 Time Series Date 在現在資料密集的時代就變成非常重要的資料，所以 Time Series Database 就有其存在的必要性，通常 Time  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/10/04/influx-go2rust/" title="InfluxDB 從 Golang 換成 Rust !"><img class="post-bg" src="/2023/10/04/influx-go2rust/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="InfluxDB 從 Golang 換成 Rust !"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/10/04/influx-go2rust/" title="InfluxDB 從 Golang 換成 Rust !">InfluxDB 從 Golang 換成 Rust !</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-10-04T06:49:00.000Z" title="Created 2023-10-04 14:49:00">2023-10-04</time></span></div><div class="content">故事最近從 CHANGE LOG 的 Prodcast 聽到 influxDB 將整個 Database 改用 Rust 重寫，這已經是不知道聽到第幾個從其他語言換到Rust 的案例，雖然還沒有正式的文章跳出來說 influxDB 從 Golang 換成 Rust 後效能提升多少，但是 CTO 在 Reddit 有提到為什麼他們從 Golang 換成 Rust，而且早在 2020 年的時候，influxDB 就有發布這個文章 Announcing InfluxDB IOx - The Future Core of InfluxDB Built with Rust and Arrow，這篇文章中就有提到他們目前在 influxDB 遇到什麼樣的問題，並開始考慮轉用 Rust 來解決他們遇到的問題。
為什麼要從 Golang 轉成 Rust ?從文章跟 Reddit 的回覆可以了解，influxDB 在 2020 的時候就遇到一些效能上的問題，尤其是想要達成 unlimited cardinality 的功能時就會需要將底層架構改寫，所以 CTO 就決定反正都要改寫，我們不如使用更穩定、效 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/10/03/less-is-more-with-postgresML/" title="PostgresML 介紹">PostgresML 介紹</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-10-02T16:06:10.000Z" title="Created 2023-10-03 00:06:10">2023-10-03</time></span></div><div class="content">前文最近 CMU Database group 又開始新一輪的資料庫相關的 Seminar，這一次看起來都搭上潮流，幾乎都是跟 AI 有關，剛好看到一個演講叫做 PostgresML: Why Moving the Compute to the Data is Better than the Alternative，讓我非常好奇，是怎麼把計算搬移到資料上？不過我對於 ML 完全不熟，所以以下的內容都會是我以後端工程師的觀點的想法。
傳統微服務在機器學習上遇到什麼問題在演講中 Montana 提到傳統的微服務雖然能夠解決 Scalability 的問題，但是也會增加服務跟服務之間傳輸的網路延遲，另外切成不同微服務也有可能讓不同團隊根據其需求選擇適合的 Database，這樣序列化跟反序列化就也是個效能上的消耗。
PostgresML 解決什麼樣的痛點
複雜的微服務架構帶來效能損耗 ML 在實際的應用上就是預測，越即時的預測越能夠帶來更好的效益，但是微服務的壞處讓 ML 很難做到即時的預測，所以 PostgresML 想要將服務簡單化，透過 Postgres 的 Connection Po ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Fan</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Noahnut" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/qi-fan-zhuang-7664491a2/" target="_blank" title="Linkedin"><i class="fab fa-linkedin" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:liveinthewide@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/16/map-reduce/" title="論文閱讀： MapReduce Simplified Data Processing on Larger Clusters">論文閱讀： MapReduce Simplified Data Processing on Larger Clusters</a><time datetime="2023-11-15T16:09:23.000Z" title="Created 2023-11-16 00:09:23">2023-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/10/chean-architecture-chapter-two/" title="Clean Architecture Chapter Two">Clean Architecture Chapter Two</a><time datetime="2023-11-10T13:42:00.000Z" title="Created 2023-11-10 21:42:00">2023-11-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/09/chear-architechure-chapter-one/" title="Clean Architecture Chapter One">Clean Architecture Chapter One</a><time datetime="2023-11-09T13:47:15.000Z" title="Created 2023-11-09 21:47:15">2023-11-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/21/cache-intro/" title="什麼是 Cache">什麼是 Cache</a><time datetime="2023-10-21T08:15:38.000Z" title="Created 2023-10-21 16:15:38">2023-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/05/intro-time-series-db/" title="Time Series Database 簡介"><img src="/2023/10/05/intro-time-series-db/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Time Series Database 簡介"/></a><div class="content"><a class="title" href="/2023/10/05/intro-time-series-db/" title="Time Series Database 簡介">Time Series Database 簡介</a><time datetime="2023-10-04T16:32:17.000Z" title="Created 2023-10-05 00:32:17">2023-10-05</time></div></div></div></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/book/" style="font-size: 1.3em; color: #99a1ac">book</a> <a href="/tags/backend/" style="font-size: 1.5em; color: #99a9bf">backend</a> <a href="/tags/machine-learning/" style="font-size: 1.1em; color: #999">machine learning</a> <a href="/tags/postgres/" style="font-size: 1.1em; color: #999">postgres</a> <a href="/tags/database/" style="font-size: 1.3em; color: #99a1ac">database</a> <a href="/tags/paper/" style="font-size: 1.1em; color: #999">paper</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><span class="card-archive-list-count">4</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">7</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-11-16T03:06:48.019Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Fan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>